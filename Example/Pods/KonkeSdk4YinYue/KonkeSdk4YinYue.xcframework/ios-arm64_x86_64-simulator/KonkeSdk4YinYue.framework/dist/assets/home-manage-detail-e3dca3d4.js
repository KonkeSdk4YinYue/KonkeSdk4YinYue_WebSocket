import{h as H,b as n,m as T,i as P,_ as x,c as h,a as d,w as k,F as b,o as c,r as B,j,t as F,k as C,f as N,p as O,d as V,e as L}from"./_plugin-vue_export-helper-4f5b7d1e.js";import{c as M,e as K,t as _,m as E,a as q,p as R,I as Y,H as G,w as z}from"./index-bf3f378e.js";/* empty css              *//* empty css              *//* empty css              */import{D as J}from"./index-33c47ae9.js";import{B as Q}from"./index-e93e7391.js";import{C as W}from"./index-6a50b8f9.js";import{C as X}from"./index-e990ab3d.js";import{F as Z}from"./index-73da5595.js";import{_ as $}from"./nav-bar-1594fc52.js";import{h as ee,j as oe,k as te,l as se,m as ne}from"./api-308b1525.js";import{p as ae,a as le,P as ie}from"./index-fb04ff69.js";import{L as re}from"./index-a604daa8.js";import{a as D}from"./function-call-4776fd23.js";import"./use-touch-6a5c47ae.js";import"./use-route-2687c77d.js";import"./use-id-30d68b53.js";const[ce,l]=M("action-sheet"),me=K({},ae,{title:String,round:_,actions:E(),closeIcon:q("cross"),closeable:_,cancelText:String,description:String,closeOnPopstate:_,closeOnClickAction:Boolean,safeAreaInsetBottom:_}),he=[...le,"round","closeOnPopstate","safeAreaInsetBottom"];var de=H({name:ce,props:me,emits:["select","cancel","update:show"],setup(e,{slots:o,emit:p}){const u=s=>p("update:show",s),a=()=>{u(!1),p("cancel")},i=()=>{if(e.title)return n("div",{class:l("header")},[e.title,e.closeable&&n(Y,{name:e.closeIcon,class:[l("close"),G],onClick:a},null)])},f=()=>{if(o.cancel||e.cancelText)return[n("div",{class:l("gap")},null),n("button",{type:"button",class:l("cancel"),onClick:a},[o.cancel?o.cancel():e.cancelText])]},I=(s,r)=>s.loading?n(re,{class:l("loading-icon")},null):o.action?o.action({action:s,index:r}):[n("span",{class:l("name")},[s.name]),s.subname&&n("div",{class:l("subname")},[s.subname])],g=(s,r)=>{const{color:y,loading:t,callback:w,disabled:m,className:U}=s,S=()=>{m||t||(w&&w(s),e.closeOnClickAction&&u(!1),P(()=>p("select",s,r)))};return n("button",{type:"button",style:{color:y},class:[l("item",{loading:t,disabled:m}),U],onClick:S},[I(s,r)])},v=()=>{if(e.description||o.description){const s=o.description?o.description():e.description;return n("div",{class:l("description")},[s])}};return()=>n(ie,T({class:l(),position:"bottom","onUpdate:show":u},R(e,he)),{default:()=>{var s;return[i(),v(),n("div",{class:l("content")},[e.actions.map(g),(s=o.default)==null?void 0:s.call(o)]),f()]}})}});const pe=z(de);const ue={name:"KonkeSdk4YinYueSrcApp",data(){return{homeId:"",homeInfo:{},homeUsers:[],isAdmin:!1,showDeleteHomeDialog:!1,showAllowDialog:!1,showInviteTypeDialog:!1,willAllowUser:{}}},mounted(){this.homeId=new URLSearchParams(window.location.search).get("homeId")||"",this.getHomeInfo(),this.getHomeUsers()},methods:{onSelectInviteType(e){this.showInviteTypeDialog=!1,e.type=="phone"?window.__jsb.push({route:"home-manage-invite",params:{homeId:this.homeId}}):window.__jsb.push({route:"home-qrcode",params:{type:"Share"}})},async onAllow(){try{await ee({HUID:this.willAllowUser.HUID,status:2}),this.getHomeUsers()}catch(e){D(e.info||`${e}`)}finally{this.willAllowUser={}}},async onCancelAllow(){this.willAllowUser={}},async onDeleteHome(){try{await oe({homeId:this.homeId}),window.__jsb.pop()}catch(e){D(e.info||`${e}`)}},toUser(e){if(e.status==0){this.showAllowDialog=!0,this.willAllowUser=e;return}window.__jsb.push({route:"home-manage-user",params:{homeId:this.homeId,userId:e.sUser.userId}})},changeHome(e){this.currentHome=e,window.__homeId=e.homeId,window.__jsb.setUserDefaults({key:"homeId",value:e.homeId}),localStorage.setItem("homeId",e.homeId)},async getHomeInfo(){try{const{data:e}=await te(this.homeId);this.homeInfo=e.home||{},this.isAdmin=this.homeInfo.roleType==="Admin",console.log(this.homeInfo)}catch(e){console.log(e)}},async getHomeUsers(){try{const{data:e}=await se(this.homeId);this.homeUsers=e.homeUserList||[]}catch(e){console.log(e)}},async onSave(){try{await ne(this.homeInfo)}catch(e){console.log(e)}},toMakeOver(){window.__jsb.push({route:"home-qrcode",params:{type:"MakeOver"}})},toInvite(){window.__jsb.push({route:"home-manage-invite",params:{homeId:this.homeId}})}}},A=e=>(O("data-v-1b3f0d64"),e=e(),V(),e),we={class:"home-manage"},_e=A(()=>d("div",{class:"home-name-title"},"家庭名称",-1)),fe={key:0,class:"users-list"},Ie=A(()=>d("div",{class:"home-users-title"},"家庭成员",-1)),ge={class:"user-title-row"},ve={key:0,class:"manager-label"},ye={key:1,class:"manager-label"},ke={key:1,class:"users-list"};function be(e,o,p,u,a,i){const f=$,I=Z,g=X,v=W,s=Q,r=J,y=pe;return c(),h(b,null,[d("div",we,[n(f,{title:"家庭管理","right-text":"删除",onClickRight:o[0]||(o[0]=t=>a.showDeleteHomeDialog=!0)}),_e,n(I,{modelValue:a.homeInfo.homeName,"onUpdate:modelValue":o[1]||(o[1]=t=>a.homeInfo.homeName=t),placeholder:"请输入",onBlur:i.onSave},null,8,["modelValue","onBlur"]),a.homeUsers.length>0?(c(),h("div",fe,[n(v,null,{default:k(()=>[Ie,(c(!0),h(b,null,B(a.homeUsers,(t,w)=>(c(),j(g,{key:w,"is-link":"",onClick:m=>i.toUser(t)},{title:k(()=>{var m;return[d("div",ge,[d("div",null,F((m=t.sUser)==null?void 0:m.nickname),1),t.roleType=="Manager"?(c(),h("div",ve,"管理员")):C("",!0),t.status==0?(c(),h("div",ye,"待审核")):C("",!0)])]}),_:2},1032,["onClick"]))),128))]),_:1})])):(c(),h("div",ke)),n(s,{type:"primary",color:"#FD7D28FF",class:"primary-button",onClick:o[2]||(o[2]=t=>a.showInviteTypeDialog=!0)},{default:k(()=>[N("邀请家人")]),_:1}),d("div",{class:"plain-button",onClick:o[3]||(o[3]=(...t)=>i.toMakeOver&&i.toMakeOver(...t))},"移交权限")]),n(r,{show:a.showDeleteHomeDialog,"onUpdate:show":o[4]||(o[4]=t=>a.showDeleteHomeDialog=t),title:"是否删除该家庭？",message:"删除后将无法访问该家庭","show-cancel-button":"",onConfirm:i.onDeleteHome},null,8,["show","onConfirm"]),n(r,{show:a.showAllowDialog,"onUpdate:show":o[5]||(o[5]=t=>a.showAllowDialog=t),title:"是否允许加入家庭？","show-cancel-button":"",onConfirm:i.onAllow,onCancel:i.onCancelAllow},null,8,["show","onConfirm","onCancel"]),n(y,{show:a.showInviteTypeDialog,"onUpdate:show":o[6]||(o[6]=t=>a.showInviteTypeDialog=t),actions:[{name:"手机号",type:"phone"},{name:"二维码"}],"cancel-text":"取消",onCancel:o[7]||(o[7]=t=>a.showInviteTypeDialog=!1),onSelect:i.onSelectInviteType},null,8,["show","onSelect"])],64)}const Ce=x(ue,[["render",be],["__scopeId","data-v-1b3f0d64"]]);L(Ce).mount("#root");
