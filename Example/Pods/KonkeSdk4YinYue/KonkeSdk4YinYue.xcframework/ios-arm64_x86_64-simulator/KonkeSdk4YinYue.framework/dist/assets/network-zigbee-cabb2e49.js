import{_ as w,c as l,b as v,a as o,t as _,w as m,o as c,F as g,r as D,j as k,p as f,d as I,e as x}from"./_plugin-vue_export-helper-4f5b7d1e.js";import"./index-bf3f378e.js";import{G as y,a as B}from"./index-30038f31.js";import{_ as b}from"./nav-bar-1594fc52.js";import{E as U,e as a}from"./api-308b1525.js";import{g as L}from"./dev-image-f6fc399c.js";import{g as S}from"./urlparse-f25d0f77.js";import{a as i}from"./function-call-4776fd23.js";import"./use-route-2687c77d.js";import"./use-touch-6a5c47ae.js";import"./index-fb04ff69.js";import"./index-a604daa8.js";const T=""+new URL("ic_network_zigbee-f14eba9d.svg",import.meta.url).href;const C={name:"KonkeSdk4YinYueSrcApp",data(){return{countdown:120,countdownNum:60,timer:null,network_text:"组网中...",networkBtnText:"停止组网",deviceList:[],getDevImage:L,gatewayUserDeviceId:0,isDiscovering:!1}},mounted(){window.__eventBus.on("Joined",e=>{console.log("_eventBus.on",e),this.deviceList.push(e)}),this.getUrlParams(),this.openDevDiscover()},unmounted(){this.isDiscovering&&this.stopDevDiscover()},methods:{getUrlParams(){let e=window.location.search;const t=S(e);console.log(t),t!=null&&"gatewayUserDeviceId"in t&&(this.gatewayUserDeviceId=t.gatewayUserDeviceId,console.log(this.devId))},onClickLeft(){window.__jsb.pop()},clickItem(e){window.__jsb.push({route:"devedit",params:{devId:e.userDeviceId}})},openDevDiscover(){this.gatewayUserDeviceId==0?U().then(e=>{if(e.data.userDeviceList==null||e.data.userDeviceList.length==0){i("请用扫一扫添加网关");return}this.gatewayUserDeviceId=e.data.userDeviceList[0].userDeviceId,a(this.gatewayUserDeviceId,"SetDiscoverZigbeeOn").then(t=>{this.isDiscovering=!0,this.networkBtnText="停止组网",this.network_text="组网中...",this.countdown=120,this.timer=setInterval(()=>{this.countdown>0?(this.countdown--,this.networkBtnText="停止组网("+this.countdown+"S)",this.network_text="组网中..."):(clearInterval(this.timer),this.isDiscovering=!1,this.networkBtnText="开始组网",this.network_text="组网结束")},1e3)}).catch(t=>i(t))}).catch(e=>i(e)):a(this.gatewayUserDeviceId,"SetDiscoverZigbeeOn").then(e=>{console.log(e),this.isDiscovering=!0,this.networkBtnText="停止组网",this.network_text="组网中...",this.countdown=120,this.timer=setInterval(()=>{this.countdown>0?(this.countdown--,this.networkBtnText="停止组网("+this.countdown+"S)",this.network_text="组网中..."):(clearInterval(this.timer),this.isDiscovering=!1,this.networkBtnText="开始组网",this.network_text="组网结束")},1e3)}).catch(e=>i(e))},stopDevDiscover(){if(!this.isDiscovering){this.openDevDiscover();return}a(this.gatewayUserDeviceId,"SetDiscoverZigbeeOff").then(e=>{this.isDiscovering=!1,this.networkBtnText="开始组网",this.network_text="组网结束"}).catch(e=>i(e))}}},d=e=>(f("data-v-05d6094e"),e=e(),I(),e),j={class:"home"},A=d(()=>o("img",{class:"ic_network",src:T},null,-1)),N={class:"tv_network"},G=d(()=>o("div",{class:"divider"},null,-1)),O=d(()=>o("div",{class:"net_hint"},"已入网设备",-1));function P(e,t,z,E,n,r){const h=b,u=B,p=y;return c(),l("div",j,[v(h,{class:"nav_bar",title:"组网",onClickLeft:r.onClickLeft},null,8,["onClickLeft"]),A,o("div",N,_(n.network_text),1),G,O,v(p,{class:"grid",direction:"horizontal",gutter:10,"column-num":2,clickable:"true"},{default:m(()=>[(c(!0),l(g,null,D(n.deviceList,s=>(c(),k(u,{class:"dev_item",key:s.userDeviceId,onClick:F=>r.clickItem(s),icon:n.getDevImage(s.device.cateType),text:s.deviceName},null,8,["onClick","icon","text"]))),128))]),_:1}),o("div",{class:"btn_stop",onClick:t[0]||(t[0]=(...s)=>r.stopDevDiscover&&r.stopDevDiscover(...s))},_(n.networkBtnText),1)])}const Z=w(C,[["render",P],["__scopeId","data-v-05d6094e"]]);x(Z).mount("#root");
