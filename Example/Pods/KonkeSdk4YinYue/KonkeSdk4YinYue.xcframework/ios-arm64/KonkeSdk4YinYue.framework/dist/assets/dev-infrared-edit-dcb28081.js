import{_,c as f,b as c,w as D,g as w,v as g,a,o as y,p as N,d as C,l as L,e as T}from"./_plugin-vue_export-helper-4f5b7d1e.js";import"./index-bf3f378e.js";/* empty css              *//* empty css              */import"./index-e990ab3d.js";import{F as b}from"./index-73da5595.js";import{_ as k}from"./nav-bar-1594fc52.js";import{R as S}from"./room-component-7b903318.js";import{S as P}from"./scene-action-light-component-699fb0c9.js";import{f as R,p,q as U,t as m,u as V,r as j}from"./api-308b1525.js";import{g as x}from"./urlparse-f25d0f77.js";import{a as r}from"./function-call-4776fd23.js";import{P as O}from"./index-fb04ff69.js";import"./use-route-2687c77d.js";import"./use-id-30d68b53.js";import"./use-touch-6a5c47ae.js";import"./index-ebd2fbba.js";import"./index-b5a1cd1d.js";import"./index-6a50b8f9.js";/* empty css              */import"./index-284dcd17.js";import"./index-3b5238ca.js";import"./index-a604daa8.js";const A={components:{SceneActionLight:P,RoomListPop:S},data(){return{devName:"",room_sel_show:!1,roomList:[],roomName:"",roomId:-1,devId:-1,typeName:"",userDevice:{},rcType:"",codeId:-1,codeType:"",isNewCode:!1,nodeId:-1,keyList:[]}},mounted(){this.getUrlParams(),window.__eventBus.on("infraredLibCode",o=>{console.log(o),this.rcType=o.rcType,this.typeName=this.rcType=="AC"?"空调":this.rcType=="TV"?"电视":"风扇",this.codeId=o.codeId,this.codeType=o.codeType,this.keyList=o.keyList,this.isNewCode=!0})},methods:{getUrlParams(){let o=window.location.search;const e=x(o);console.log(e),e!=null&&"devId"in e&&(this.devId=e.devId,console.log(this.devId),this.devId!=null&&this.devId!=-1&&this.getDevInfo()),"nodeId"in e&&(this.nodeId=e.nodeId)},getDevInfo(){R({userDeviceId:this.devId}).then(o=>{var e;console.log(o),this.userDevice=o.data.userDeviceList[0],this.roomName=(e=o.data.userDeviceList[0])==null?void 0:e.roomName,this.roomId=o.data.userDeviceList[0].roomId,this.devName=o.data.userDeviceList[0].deviceName,console.log("userex ",JSON.parse(this.userDevice.userExtension)),this.rcType=JSON.parse(this.userDevice.userExtension).rcType,this.typeName=this.rcType=="AC"?"空调":this.rcType=="TV"?"电视":"风扇"}).catch(o=>r(o))},onClickLeft(){window.__jsb.pop()},onClickRight(){var o;if(this.devName==""){r("请输入设备名称");return}if(this.roomId==-1){r("请选择房间");return}try{if(this.isNewCode)if(this.codeType=="cloud"){const e={};e.codeId=this.codeId,e.channelId=this.nodeId==-1?this.userDevice.nodeId:this.nodeId,e.isMajor=!0,e.rcType="AC";const i={};i.roomId=this.userDevice.roomId,i.parentDeviceId=this.nodeId==-1?this.userDevice.parentUserDeviceId:this.devId,i.isMaster=!1,i.remoteList=e,i.deviceName=this.userDevice.deviceName,i.nodeId=this.nodeId==-1?this.userDevice.nodeId:this.nodeId;const n={};n.rcType="AC",i.extension=JSON.stringify(n),console.log("device: ",i),p(i).then(s=>{console.log("createDevice",s),U(this.devId,this.codeId,this.nodeId==-1?this.userDevice.nodeId:this.nodeId).then(t=>{m(s.data.userDevice.userDeviceId,this.devName,this.roomId).then(v=>{window.__jsb.forwardEvent({eventName:"reload",fromPage:"devedit",toPage:""}),window.__jsb.pop()})}).catch(t=>{r(t)}),console.log("bindcodelib",s)}).catch(s=>{console.log("err",s)})}else{console.log("sava codes");const e={};e.roomId=this.userDevice.roomId,e.parentDeviceId=this.nodeId==-1?this.userDevice.parentUserDeviceId:this.devId,e.isMaster=!1,e.remoterKeysList=this.keyList,e.deviceName=this.userDevice.deviceName,e.nodeId=this.nodeId==-1?this.userDevice.nodeId:this.nodeId;const i={};i.rcType=this.rcType,e.extension=JSON.stringify(i),e.typeId=-1,console.log("device2: ",(o=this.userDevice)==null?void 0:o.UDID),e.udid=this.userDevice.UDID.indexOf("$")!=-1?this.userDevice.UDID:this.userDevice.UDID+"$"+this.nodeId,console.log("device: ",e),p(e).then(n=>{m(n.data.userDevice.userDeviceId,this.devName,this.roomId).then(s=>{window.__jsb.forwardEvent({eventName:"reload",fromPage:"devedit",toPage:""}),window.__jsb.pop()})}).catch(n=>{console.log("err",n)})}else m(this.devId,this.devName,this.roomId).then(e=>{window.__jsb.forwardEvent({eventName:"reload",fromPage:"devedit",toPage:""}),window.__jsb.pop()})}catch(e){r(e)}},toSelType(){window.__jsb.push({route:"dev-infrared-type",params:{devId:this.devId,nodeId:this.userDevice.nodeId==null?1:this.userDevice.nodeId}})},delDev(){V(this.devId).then(o=>{window.__jsb.forwardEvent({eventName:"reload",eventData:"",fromPage:"devedit",toPage:""}),window.__jsb.pop()}).catch(o=>{r(o)})},selRoom(){this.room_sel_show=!0,j().then(o=>{o.code==200?this.roomList=o.data.roomList:r(o.info)})},onRoomSelCancel(){this.room_sel_show=!1},onRoomSelConfirm(o){console.log("onRoomSelConfirm",o),this.roomName=o.roomName,this.roomId=o.roomId,this.room_sel_show=!1}}},h=o=>(N("data-v-90fa1ad2"),o=o(),C(),o),E={class:"home"},B=h(()=>a("div",{class:"name_hint"}," 设备名称 ",-1)),J=h(()=>a("div",{class:"name_hint"}," 房间 ",-1)),M=h(()=>a("div",{class:"name_hint"}," 红外配置 ",-1));function F(o,e,i,n,s,t){const v=k,l=b,u=L("RoomListPop"),I=O;return y(),f("div",E,[c(v,{class:"nav_bar",title:"编辑设备","right-text":"保存",onClickRight:t.onClickRight,onClickLeft:t.onClickLeft},null,8,["onClickRight","onClickLeft"]),B,c(l,{class:"input",modelValue:s.devName,"onUpdate:modelValue":e[0]||(e[0]=d=>s.devName=d),clearable:"",placeholder:"请输入设备名称"},null,8,["modelValue"]),J,c(l,{class:"input",modelValue:s.roomName,"onUpdate:modelValue":e[1]||(e[1]=d=>s.roomName=d),onClick:t.selRoom,"right-icon":"arrow ",readonly:"",placeholder:"请选择房间"},null,8,["modelValue","onClick"]),M,c(l,{class:"input",modelValue:s.typeName,"onUpdate:modelValue":e[2]||(e[2]=d=>s.typeName=d),onClick:t.toSelType,"right-icon":"arrow ",readonly:"",placeholder:"请选择红外类型"},null,8,["modelValue","onClick"]),c(I,{show:s.room_sel_show,"onUpdate:show":e[3]||(e[3]=d=>s.room_sel_show=d),position:"bottom"},{default:D(()=>[c(u,{list:s.roomList,onOnCancal:t.onRoomSelCancel,onOnConfirm:t.onRoomSelConfirm},null,8,["list","onOnCancal","onOnConfirm"])]),_:1},8,["show"]),w(a("div",{class:"del_text",onClick:e[4]||(e[4]=(...d)=>t.delDev&&t.delDev(...d))},"删除设备",512),[[g,s.devId!=null&&s.devId!=-1]])])}const q=_(A,[["render",F],["__scopeId","data-v-90fa1ad2"]]);T(q).mount("#root");
