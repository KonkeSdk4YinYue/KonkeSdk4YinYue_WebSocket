import{C as B,J as Z,E as A,q as P,h as D,b as u,T as L,g as _,v as R,s as J,A as W,B as Q,I as X,M as ee,F as oe,m as ne,i as te}from"./_plugin-vue_export-helper-4f5b7d1e.js";import{n as k,t as y,d as p,z as ae,A as se,C as N,c as K,D as $,e as M,q as le,v as j,w as F,a as z,E as ce,P as re,H as ie,I as ue}from"./index-bf3f378e.js";import{a as de,u as fe,c as ve}from"./use-touch-6a5c47ae.js";const H={show:Boolean,zIndex:k,overlay:y,duration:k,teleport:[String,Object],lockScroll:y,lazyRender:y,beforeClose:Function,overlayStyle:Object,overlayClass:p,transitionAppear:Boolean,closeOnClickOverlay:y},ze=Object.keys(H);let h=0;const E="van-overflow-hidden";function ye(e,o){const t=de(),d="01",a="10",c=r=>{t.move(r);const f=t.deltaY.value>0?a:d,b=se(r.target,e.value),{scrollHeight:m,offsetHeight:O,scrollTop:C}=b;let v="11";C===0?v=O>=m?"00":"01":C+O>=m&&(v="10"),v!=="11"&&t.isVertical()&&!(parseInt(v,2)&parseInt(f,2))&&N(r,!0)},s=()=>{document.addEventListener("touchstart",t.start),document.addEventListener("touchmove",c,{passive:!1}),h||document.body.classList.add(E),h++},l=()=>{h&&(document.removeEventListener("touchstart",t.start),document.removeEventListener("touchmove",c),h--,h||document.body.classList.remove(E))},S=()=>o()&&s(),I=()=>o()&&l();ae(S),B(I),Z(I),A(o,r=>{r?s():l()})}function G(e){const o=P(!1);return A(e,t=>{t&&(o.value=t)},{immediate:!0}),t=>()=>o.value?t():null}const[me,he]=K("overlay"),Ie={show:Boolean,zIndex:k,duration:k,className:p,lockScroll:y,lazyRender:y,customStyle:Object};var Oe=D({name:me,props:Ie,setup(e,{slots:o}){const t=P(),d=G(()=>e.show||!e.lazyRender),a=s=>{e.lockScroll&&N(s,!0)},c=d(()=>{var s;const l=M(le(e.zIndex),e.customStyle);return j(e.duration)&&(l.animationDuration=`${e.duration}s`),_(u("div",{ref:t,style:l,class:[he(),e.className]},[(s=o.default)==null?void 0:s.call(o)]),[[R,e.show]])});return $("touchmove",a,{target:t}),()=>u(L,{name:"van-fade",appear:!0},{default:c})}});const Ce=F(Oe),we=M({},H,{round:Boolean,position:z("center"),closeIcon:z("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:z("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[Pe,T]=K("popup");var ke=D({name:Pe,inheritAttrs:!1,props:we,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:o,attrs:t,slots:d}){let a,c;const s=P(),l=P(),S=G(()=>e.show||!e.lazyRender),I=J(()=>{const n={zIndex:s.value};if(j(e.duration)){const i=e.position==="center"?"animationDuration":"transitionDuration";n[i]=`${e.duration}s`}return n}),r=()=>{a||(a=!0,s.value=e.zIndex!==void 0?+e.zIndex:ce(),o("open"))},f=()=>{a&&ve(e.beforeClose,{done(){a=!1,o("close"),o("update:show",!1)}})},b=n=>{o("clickOverlay",n),e.closeOnClickOverlay&&f()},m=()=>{if(e.overlay)return u(Ce,{show:e.show,class:e.overlayClass,zIndex:s.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0,onClick:b},{default:d["overlay-content"]})},O=n=>{o("clickCloseIcon",n),f()},C=()=>{if(e.closeable)return u(ue,{role:"button",tabindex:0,name:e.closeIcon,class:[T("close-icon",e.closeIconPosition),ie],classPrefix:e.iconPrefix,onClick:O},null)},v=()=>o("opened"),U=()=>o("closed"),Y=n=>o("keydown",n),q=S(()=>{var n;const{round:i,position:w,safeAreaInsetTop:x,safeAreaInsetBottom:V}=e;return _(u("div",ne({ref:l,style:I.value,role:"dialog",tabindex:0,class:[T({round:i,[w]:w}),{"van-safe-area-top":x,"van-safe-area-bottom":V}],onKeydown:Y},t),[(n=d.default)==null?void 0:n.call(d),C()]),[[R,e.show]])}),g=()=>{const{position:n,transition:i,transitionAppear:w}=e,x=n==="center"?"van-fade":`van-popup-slide-${n}`;return u(L,{name:i||x,appear:w,onAfterEnter:v,onAfterLeave:U},{default:q})};return A(()=>e.show,n=>{n&&!a&&(r(),t.tabindex===0&&te(()=>{var i;(i=l.value)==null||i.focus()})),!n&&a&&(a=!1,o("close"))}),fe({popupRef:l}),ye(l,()=>e.show&&e.lockScroll),$("popstate",()=>{e.closeOnPopstate&&(f(),c=!1)}),W(()=>{e.show&&r()}),Q(()=>{c&&(o("update:show",!0),c=!1)}),B(()=>{e.show&&e.teleport&&(f(),c=!0)}),X(re,()=>e.show),()=>e.teleport?u(ee,{to:e.teleport},{default:()=>[m(),g()]}):u(oe,null,[m(),g()])}});const Ae=F(ke);export{Ce as O,Ae as P,ze as a,H as p};
